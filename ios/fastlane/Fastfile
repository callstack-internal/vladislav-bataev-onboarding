default_platform(:ios)

platform :ios do
  desc "Run E2E tests for the iOS app"
  lane :e2e_tests do
    sh("npm install")

    cocoapods

    xcodebuild(
      configuration: "Release",
      scheme: "weatherApp",
      workspace: "weatherApp.xcworkspace",
      xcargs: "-quiet -sdk 'iphonesimulator' -destination 'generic/platform=iOS Simulator'",
      derivedDataPath: "ios/build"
    )

    sh("maestro-cloud --api-key #{ENV['MAESTRO_CLOUD_API_KEY']} --app-file ios/build/Build/Products/Release-iphonesimulator/weatherApp.app --workspace .maestro/ios/")
  end
end
